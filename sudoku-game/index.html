<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sudoku Game</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #4e73df, #1cc88a);
    color: white;
    padding: 20px;
    min-height: 100vh;
  }
  h1 { font-size: clamp(32px, 8vw, 40px); text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }

  .start-screen, .game-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 80vh;
  }

  /* ÈÄöÁî®ÊéßÂà∂ÊåâÈíÆ */
  .control-btn {
    font-size: clamp(16px, 4vw, 20px);
    padding: 12px 24px;
    margin: 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background-color: #28a745;
    color: white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
    font-weight: bold;
    min-width: 180px;
  }
  .control-btn:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    filter: brightness(1.1);
  }

  /* --- Êñ∞Â¢ûÔºöÂàÜÊï∞Èù¢ÊùøÊ†∑Âºè --- */
  .score-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
  }
  .score-content {
    background: white;
    color: #333;
    padding: 30px;
    border-radius: 20px;
    width: 300px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  @keyframes popIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  .score-content h2 { margin-top: 0; color: #4e73df; }
  .score-number { font-size: 48px; font-weight: bold; color: #1cc88a; margin: 15px 0; }
  /* ----------------------- */

  .sudoku-container { 
    display: flex; 
    gap: 30px; 
    align-items: flex-start; 
    margin-top: 20px; 
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 15px;
    backdrop-filter: blur(5px);
  }

  /* Êï∞Áã¨ÁΩëÊ†ºÊ†∑Âºè */
  .sudoku-grid {
    display: grid;
    grid-template-columns: repeat(9, 44px);
    grid-template-rows: repeat(9, 44px);
    gap: 0; 
    border: 4px solid #000;
    background-color: white;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }

  .cell {
    width: 44px;
    height: 44px;
    font-size: 24px;
    text-align: center;
    line-height: 44px;
    cursor: pointer;
    user-select: none;
    color: #333;
    background-color: #e6e6e6; /* ÂæÖÂ°´Âå∫ÁÅ∞Ëâ≤ */
    border-right: 1px solid #000;
    border-bottom: 1px solid #000;
  }

  .cell.prefilled { 
    font-weight: 800; 
    cursor: default; 
    background-color: #ffffff; 
    color: #000;
  }

  .cell.selected { 
    background-color: #bbdefb !important; 
    outline: none;
  }
  
  /* ‰πùÂÆ´Ê†ºÁ≤óÁ∫ø */
  .cell.border-right-bold { border-right: 3px solid #000; }
  .cell.border-bottom-bold { border-bottom: 3px solid #000; }
  .cell:nth-child(9n) { border-right: none; } 
  .cell:nth-last-child(-n+9) { border-bottom: none; }

  .right-panel { display: flex; flex-direction: column; gap: 20px; }

  .number-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
  
  .num-btn {
    width: 45px; height: 45px; padding: 0; margin: 0; font-size: 22px;
    background-color: #f8f9fa; color: #333; border: 1px solid #ccc;
    border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer;
  }
  .num-btn:hover { background-color: #e2e6ea; color: #0056b3; }
  .num-btn:disabled { opacity: 0.6; cursor: not-allowed; }

  /* Â∑•ÂÖ∑Ê†è */
  .tools-options { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }

  .tool-btn {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 5px; background-color: #ffc107; border: none; border-radius: 8px;
    cursor: pointer; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    height: 60px; width: 50px;
  }
  .tool-btn:hover { background-color: #e0a800; }
  .tool-btn:disabled { background-color: #e9ecef; color: #adb5bd; cursor: not-allowed; }

  .tool-icon { font-size: 20px; margin-bottom: 2px; }
  .tool-name { font-size: 10px; font-weight: bold; text-transform: uppercase; }

  .footer { position: fixed; bottom: 10px; left: 10px; font-size: 14px; opacity: 0.9; }
  .timer-score { display: flex; justify-content: center; gap: 30px; margin-top: 15px; font-size: 22px; font-weight: bold;}
  .feedback { margin-top: 15px; font-size: 22px; min-height: 30px; font-weight: bold; }

  @media (max-width: 650px){
    .sudoku-container { flex-direction: column; align-items: center; padding: 10px;}
    .sudoku-grid { grid-template-columns: repeat(9, 34px); grid-template-rows: repeat(9,34px);}
    .cell { width: 34px; height: 34px; font-size: 18px; line-height: 34px; }
    .number-options { grid-template-columns: repeat(9, 1fr); }
    .num-btn { width: 32px; height: 32px; font-size: 16px; }
  }
</style>
</head>
<body>

<div class="start-screen" id="startScreen">
  <h1>Sudoku Challenge</h1>
  <button class="control-btn" onclick="startGame()">Start Game</button>
  <button class="control-btn" onclick="showScoreModal()" style="background-color: #6c757d;">View Score</button>
</div>

<div class="score-modal" id="scoreModal" onclick="closeScoreModal()">
  <div class="score-content" onclick="event.stopPropagation()">
    <div style="font-size: 40px;">üèÜ</div>
    <h2>Your Score</h2>
    <div class="score-number" id="modalScoreValue">0</div>
    <button class="control-btn" onclick="closeScoreModal()" style="min-width: 120px; background-color: #4e73df;">Got it!</button>
  </div>
</div>

<div class="game-container" id="gameContainer" style="display:none;">
  <div class="timer-score">
    <div>Time: <span id="timer">900</span>s</div>
    <div>Score: <span id="score">0</span></div>
  </div>

  <div class="sudoku-container">
    <div class="sudoku-grid" id="sudokuGrid"></div>
    
    <div class="right-panel">
      <div class="number-options" id="numberOptions"></div>
      
      <div class="tools-options">
        <button class="tool-btn" onclick="undo()" id="btnUndo">
          <span class="tool-icon">&#8617;</span>
          <span class="tool-name">Undo</span>
        </button>
        <button class="tool-btn" onclick="redo()" id="btnRedo">
          <span class="tool-icon">&#8618;</span>
          <span class="tool-name">Redo</span>
        </button>
        <button class="tool-btn" onclick="deleteNumber()" id="btnDelete">
          <span class="tool-icon">&#128465;</span>
          <span class="tool-name">Del</span>
        </button>
        <button class="tool-btn" onclick="useHint()" id="btnHint">
          <span class="tool-icon">&#128161;</span>
          <span class="tool-name">Hint <span id="hintCount">(2)</span></span>
        </button>
      </div>
    </div>
  </div>

  <div style="margin-top:20px;">
    <button class="control-btn" onclick="checkSudoku()" id="btnCheck" style="background-color:#007bff;">Check Answer</button>
    <button class="control-btn" onclick="newSudoku()" style="background-color:#17a2b8;">New Game</button>
    <button class="control-btn" onclick="exitGame()" style="background-color:#dc3545;">Exit</button>
  </div>

  <div class="feedback" id="feedback"></div>
</div>

<div class="footer">
  Author: XIA RUI DONG | Contact: xiarui091@gmail.com
</div>

<script>
let board = [];
let solution = [];
let initialBoard = [];
let timerInterval = null;
let timeLeft = 900; 
let score = 0;
let selectedCell = null;
let gameActive = false;

let history = []; 
let historyStep = -1;
let hintsLeft = 2;

// --- ÊîπËøõÁöÑÂàÜÊï∞ÊòæÁ§∫ÈÄªËæë ---
function showScoreModal() {
  document.getElementById("modalScoreValue").innerText = score;
  document.getElementById("scoreModal").style.display = "flex";
}

function closeScoreModal() {
  document.getElementById("scoreModal").style.display = "none";
}
// -----------------------

function startGame(){
  document.getElementById("startScreen").style.display = "none";
  document.getElementById("gameContainer").style.display = "flex";
  document.getElementById("score").innerText = score;
  newSudoku();
}

function exitGame(){
  clearInterval(timerInterval);
  document.getElementById("gameContainer").style.display = "none";
  document.getElementById("startScreen").style.display = "flex";
}

function startTimer(){
  clearInterval(timerInterval);
  timeLeft = 900; 
  document.getElementById("timer").innerText = timeLeft;
  gameActive = true;
  updateUIState();
  
  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").innerText = timeLeft;
    if(timeLeft<=0){
      clearInterval(timerInterval);
      endGameTimeUp();
    }
  },1000);
}

function endGameTimeUp(){
  gameActive = false;
  document.getElementById("feedback").innerText = "Time's up! Game Over.";
  document.getElementById("feedback").className = "feedback incorrect";
  updateUIState();
}

function updateUIState(){
  const btns = document.querySelectorAll('.num-btn, .tool-btn, #btnCheck');
  btns.forEach(btn => btn.disabled = !gameActive);
  if(hintsLeft <= 0) document.getElementById("btnHint").disabled = true;
}

function generateEmptyGrid(){ return Array.from({length:9},()=>Array(9).fill(0)); }

function fillBoard(b){
  function isValid(num,row,col){
    for(let i=0;i<9;i++) if(b[row][i]===num || b[i][col]===num) return false;
    let startRow=Math.floor(row/3)*3,startCol=Math.floor(col/3)*3;
    for(let i=0;i<3;i++) for(let j=0;j<3;j++) if(b[startRow+i][startCol+j]===num) return false;
    return true;
  }
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      if(b[r][c]===0){
        let nums=[1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-0.5);
        for(let n of nums){
          if(isValid(n,r,c)){
            b[r][c]=n;
            if(fillBoard(b)) return true;
            b[r][c]=0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

function removeCells(b,difficulty=40){
  let cellsToRemove=difficulty;
  while(cellsToRemove>0){
    let r=Math.floor(Math.random()*9), c=Math.floor(Math.random()*9);
    if(b[r][c]!==0){ b[r][c]=0; cellsToRemove--; }
  }
  return b;
}

function newSudoku(){
  board = generateEmptyGrid();
  fillBoard(board);
  solution = board.map(r=>[...r]);
  board = removeCells(board);
  initialBoard = board.map(r=>[...r]);

  selectedCell = null;
  history = [];
  historyStep = -1;
  hintsLeft = 2;
  document.getElementById("hintCount").innerText = `(${hintsLeft})`;
  document.getElementById("feedback").innerText="";

  startTimer();
  initGridDOM(initialBoard);
  renderNumberOptions();
  updateUIState();
}

function initGridDOM(initB) {
  const grid = document.getElementById("sudokuGrid");
  grid.innerHTML = "";
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      let cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.row = r; cell.dataset.col = c;
      if((c + 1) % 3 === 0 && c < 8) cell.classList.add("border-right-bold");
      if((r + 1) % 3 === 0 && r < 8) cell.classList.add("border-bottom-bold");

      if(initB[r][c] !== 0) {
        cell.innerText = initB[r][c];
        cell.classList.add("prefilled");
      } else {
        cell.onclick = () => selectCell(r,c,cell);
      }
      grid.appendChild(cell);
    }
  }
}

function selectCell(r,c,cell){
  if(!gameActive) return;
  if(selectedCell) selectedCell.classList.remove("selected");
  selectedCell = cell;
  selectedCell.classList.add("selected");
}

function renderNumberOptions(){
  const container = document.getElementById("numberOptions");
  container.innerHTML = "";
  for(let n=1;n<=9;n++){
    let btn = document.createElement("button");
    btn.innerText = n; btn.className = "num-btn";
    btn.onclick = ()=>insertNumber(n);
    container.appendChild(btn);
  }
}

function saveState(r, c, oldVal, newVal) {
  if(historyStep < history.length - 1) history = history.slice(0, historyStep + 1);
  history.push({r, c, oldVal, newVal});
  historyStep++;
}

function insertNumber(num){
  if(!gameActive || !selectedCell || selectedCell.classList.contains("prefilled")) return;
  let r = parseInt(selectedCell.dataset.row), c = parseInt(selectedCell.dataset.col);
  if(board[r][c] === num) return;
  saveState(r, c, board[r][c], num);
  board[r][c] = num;
  selectedCell.innerText = num;
}

function deleteNumber(){
  if(!gameActive || !selectedCell || selectedCell.classList.contains("prefilled")) return;
  let r = parseInt(selectedCell.dataset.row), c = parseInt(selectedCell.dataset.col);
  if(board[r][c] === 0) return;
  saveState(r, c, board[r][c], 0);
  board[r][c] = 0;
  selectedCell.innerText = "";
}

function undo(){
  if(!gameActive || historyStep < 0) return;
  let action = history[historyStep--];
  board[action.r][action.c] = action.oldVal;
  updateCellDOM(action.r, action.c, action.oldVal);
}

function redo(){
  if(!gameActive || historyStep >= history.length - 1) return;
  let action = history[++historyStep];
  board[action.r][action.c] = action.newVal;
  updateCellDOM(action.r, action.c, action.newVal);
}

function updateCellDOM(r, c, val){
  const cell = document.getElementById("sudokuGrid").children[r*9 + c];
  cell.innerText = val === 0 ? "" : val;
}

function useHint(){
  if(!gameActive || hintsLeft <= 0 || !selectedCell || selectedCell.classList.contains("prefilled")) return;
  let r = parseInt(selectedCell.dataset.row), c = parseInt(selectedCell.dataset.col);
  if(board[r][c] === solution[r][c]) return;

  saveState(r, c, board[r][c], solution[r][c]);
  board[r][c] = solution[r][c];
  selectedCell.innerText = solution[r][c];
  
  hintsLeft--;
  document.getElementById("hintCount").innerText = `(${hintsLeft})`;
  if(hintsLeft === 0) document.getElementById("btnHint").disabled = true;
}

function checkSudoku(){
  if(!gameActive) return;
  let correct=true;
  for(let r=0;r<9;r++) for(let c=0;c<9;c++) if(board[r][c]!==solution[r][c]) correct=false;
  
  let feedback = document.getElementById("feedback");
  if(correct){
    feedback.innerText="Correct! Excellent job! üéâ";
    feedback.className="feedback correct";
    score+=100; document.getElementById("score").innerText=score;
    clearInterval(timerInterval);
    gameActive = false;
    updateUIState();
  } else{
    feedback.innerText="Something is wrong. Keep looking!";
    feedback.className="feedback incorrect";
  }
}
</script>

</body>
</html>
