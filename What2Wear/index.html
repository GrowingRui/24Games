<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What2Wear - Smart Wardrobe Assistant</title>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.2);
            --glass-border: rgba(255, 255, 255, 0.4);
            --text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            transition: background 1s ease;
            color: white; text-shadow: var(--text-shadow);
            overflow-x: hidden;
        }

        /* 背景状态 */
        .weather-clear { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .weather-rain { background: linear-gradient(135deg, #485563 0%, #29323c 100%); }
        .weather-clouds { background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%); }

        /* 顶部工具栏：适配手机 */
        .header-tools {
            position: absolute; top: 20px; right: 20px;
            z-index: 100;
        }

        /* 修复后的语言选择器 */
        .lang-selector {
            background: rgba(0, 0, 0, 0.3); /* 深色背景确保白色文字可见 */
            color: white;
            border: 1.5px solid var(--glass-border);
            padding: 8px 30px 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        .lang-selector option { background: #333; color: white; }

        /* 主容器适配 */
        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 30px; border-radius: 35px;
            text-align: center; width: 85%; max-width: 380px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            border: 1px solid var(--glass-border);
            margin: 20px;
        }

        h1 { margin: 0; font-size: 1.8rem; letter-spacing: 2px; font-weight: 800; }
        #location { font-size: 1.1rem; opacity: 0.9; margin: 10px 0 5px 0; }
        .temp { font-size: 4rem; font-weight: 200; margin: 5px 0; }
        
        #clothing-img {
            width: 100%; max-width: 200px; height: 200px;
            object-fit: cover; border-radius: 20px;
            margin: 15px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .advice-text { font-size: 1.05rem; line-height: 1.4; min-height: 3em; }

        /* 作者信息栏 */
        .footer-info {
            position: absolute; bottom: 15px; right: 20px;
            font-size: 12px; opacity: 0.7; text-align: right;
            line-height: 1.6; pointer-events: none;
        }

        /* 响应式调整 (手机和平板) */
        @media (max-width: 480px) {
            .container { padding: 25px; }
            h1 { font-size: 1.5rem; }
            .temp { font-size: 3.5rem; }
            #clothing-img { max-width: 180px; height: 180px; }
            .header-tools { top: 15px; right: 15px; }
            .footer-info { bottom: 10px; width: 100%; text-align: center; right: 0; }
        }
    </style>
</head>
<body class="weather-clear">

    <div class="header-tools">
        <select class="lang-selector" id="langSelect" onchange="changeLanguage()">
            <option value="zh_cn">简体中文</option>
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
        </select>
    </div>

    <div class="container">
        <h1>What2Wear</h1>
        <div id="location">---</div>
        <div id="weather-desc">...</div>
        <div class="temp"><span id="temp-val">--</span>°C</div>
        
        <img id="clothing-img" src="https://via.placeholder.com/220/ffffff/cccccc?text=What2Wear" alt="Fashion">
        
        <div class="advice-text" id="advice">Detecting location...</div>
    </div>

    <div class="footer-info">
        Author: XIA RUI DONG<br>
        Contact: xiarui091@gmail.com
    </div>

<script>
    const API_KEY = '2a7f5c65709314cf776fb9958f88ceda';
    let currentLang = 'zh_cn';
    let lastCoords = null;

    const i18n = {
        zh_cn: { loading: "正在获取位置...", errLoc: "无法获取位置", hot: "烈日炎炎，穿短袖背心最清爽！", warm: "气候宜人，穿一件卫衣或衬衫吧。", cool: "天气转凉，记得加件外套或风衣。", cold: "天寒地冻，羽绒服才是本体！", apiErr: "API 尚未激活，请稍后再试" },
        en: { loading: "Locating...", errLoc: "Location Denied", hot: "It's hot! T-shirts and shorts are best.", warm: "Comfortable day. A hoodie or shirt works fine.", cool: "Getting chilly. Put on a jacket.", cold: "Freezing! Grab your heavy down coat.", apiErr: "API Key activating, please wait" },
        es: { loading: "Localizando...", errLoc: "Ubicación Denegada", hot: "¡Hace calor! Camisetas y shorts.", warm: "Día agradable. Una sudadera está bien.", cool: "Hace fresco. Ponte una chaqueta.", cold: "¡Mucho frío! Usa un abrigo pesado.", apiErr: "API activándose, espere" },
        de: { loading: "Ortung...", errLoc: "Standort abgelehnt", hot: "Heiß! T-Shirts und Shorts sind am besten.", warm: "Angenehm. Ein Hoodie oder Hemd reicht.", cool: "Kühl. Zieh eine Jacke an.", cold: "Eisig! Schnapp dir deinen Daunenmantel.", apiErr: "API wird aktiviert, bitte warten" }
    };

    window.onload = () => {
        updateStaticText();
        startApp();
    };

    function startApp() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => { lastCoords = pos; getWeather(pos); },
                () => { document.getElementById('location').innerText = i18n[currentLang].errLoc; }
            );
        }
    }

    async function getWeather(position) {
        const { latitude: lat, longitude: lon } = position.coords;
        try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${currentLang}`);
            if (!res.ok) throw new Error();
            const data = await res.json();
            updateUI(data);
        } catch (e) {
            document.getElementById('location').innerText = i18n[currentLang].apiErr;
        }
    }

    function updateUI(data) {
        const temp = Math.round(data.main.temp);
        const condition = data.weather[0].main;
        
        document.getElementById('location').innerText = data.name;
        document.getElementById('temp-val').innerText = temp;
        document.getElementById('weather-desc').innerText = data.weather[0].description;

        const b = document.body;
        b.className = '';
        if (condition === 'Clear') b.classList.add('weather-clear');
        else if (condition.includes('Rain') || condition === 'Drizzle') b.classList.add('weather-rain');
        else b.classList.add('weather-clouds');

        let adviceKey = temp >= 28 ? "hot" : temp >= 18 ? "warm" : temp >= 10 ? "cool" : "cold";
        const imgMap = {
            hot: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400",
            warm: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=400",
            cool: "https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=400",
            cold: "https://images.unsplash.com/photo-1539533377285-a41cc5e94189?w=400"
        };

        document.getElementById('advice').innerText = i18n[currentLang][adviceKey];
        document.getElementById('clothing-img').src = imgMap[adviceKey];
    }

    function updateStaticText() {
        document.getElementById('advice').innerText = i18n[currentLang].loading;
    }

    function changeLanguage() {
        currentLang = document.getElementById('langSelect').value;
        updateStaticText();
        if (lastCoords) getWeather(lastCoords);
        else startApp();
    }
</script>
</body>
</html>
