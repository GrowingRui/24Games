<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What2Wear - Updated i18n Content</title>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.15); --border: rgba(255, 255, 255, 0.25); }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', system-ui, sans-serif; color: white; overflow: hidden; background-color: #2c3e50; }
        body.rtl { direction: rtl; }
        #bg-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; transition: background 1.5s ease; }
        
        .sun-glow { position: absolute; top: -10%; right: -10%; width: 70vw; height: 70vw; background: radial-gradient(circle, rgba(255,255,150,0.3) 0%, rgba(255,255,255,0) 70%); animation: pulse 6s infinite alternate; }
        @keyframes pulse { from { opacity: 0.4; transform: scale(1); } to { opacity: 0.7; transform: scale(1.1); } }
        
        .rain { position: absolute; background: rgba(255,255,255,0.4); height: 20px; top: -30px; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }
        
        .snow { position: absolute; background: white; border-radius: 50%; opacity: 0.8; top: -10px; animation: snowFall linear infinite; }
        @keyframes snowFall { to { transform: translateY(110vh) translateX(20px); } }
        
        .cloud { position: absolute; background: rgba(255,255,255,0.4); filter: blur(40px); border-radius: 50%; animation: drift linear infinite; }
        @keyframes drift { from { left: -200px; } to { left: 100vw; } }

        #app-content { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 15px; }
        .container { background: var(--glass); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); padding: 25px; border-radius: 40px; text-align: center; width: 100%; max-width: 480px; border: 1px solid var(--border); box-shadow: 0 25px 50px rgba(0,0,0,0.3); }
        .header-tools { display: flex; gap: 10px; margin-bottom: 15px; }
        .search-box { flex: 1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 20px; padding: 8px 15px; color: white; outline: none; }
        .lang-selector { background: rgba(0,0,0,0.5); color: white; border: 1px solid var(--border); padding: 8px; border-radius: 20px; }
        .day-nav { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 5px 0; font-weight: bold; }
        .nav-btn { cursor: pointer; background: none; border: none; color: white; font-size: 1.5rem; padding: 0 10px; opacity: 0.7; }
        .metrics { display: flex; justify-content: center; gap: 12px; margin: 15px 0; }
        .metric-card { background: rgba(0,0,0,0.25); padding: 12px 10px; border-radius: 18px; flex: 1; min-width: 100px; position: relative; }
        .metric-title { font-size: 0.7rem; opacity: 0.8; margin-bottom: 2px; text-transform: uppercase; }
        .metric-value { font-size: 1.1rem; font-weight: bold; }
        .metric-desc { font-size: 0.65rem; margin-top: 5px; padding: 3px; border-radius: 6px; background: rgba(255,255,255,0.12); }
        .aqi-bar-container { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        #aqi-bar-fill { height: 100%; width: 0%; transition: 1s ease-in-out; border-radius: 2px; }
        .temp { font-size: 4.5rem; font-weight: 100; margin: 0; }
        .advice-box { background: rgba(0,0,0,0.15); border-radius: 20px; padding: 18px; font-size: 0.85rem; line-height: 1.6; margin: 15px 0; min-height: 125px; text-align: left; }
        body.rtl .advice-box { text-align: right; }
        .hourly-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 15px 5px; margin-top: 10px; border-top: 1px solid var(--border); }
        .hourly-scroll::-webkit-scrollbar { height: 4px; }
        .hourly-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 10px; }
        .hour-item { min-width: 60px; text-align: center; border-radius: 10px; padding: 5px; flex-shrink: 0; }
        .hour-item.active { background: rgba(255,255,255,0.15); border: 1px solid var(--border); }
        .hour-time { font-size: 0.7rem; opacity: 0.7; }
        .hour-temp { font-size: 0.9rem; font-weight: bold; }
        .footer-info { position: absolute; bottom: 10px; font-size: 9px; opacity: 0.5; width: 100%; text-align: center; }
    </style>
</head>
<body>
    <div id="bg-wrapper"></div>
    <div id="app-content">
        <div class="container">
            <div class="header-tools">
                <input type="text" id="cityInput" class="search-box">
                <select class="lang-selector" id="langSelect" onchange="changeLanguage()">
                    <option value="zh_cn">CN</option>
                    <option value="en">EN</option>
                    <option value="es">ES</option>
                    <option value="de">DE</option>
                    <option value="fr">FR</option>
                    <option value="ru">RU</option>
                    <option value="ar">AR</option>
                </select>
            </div>
            <div id="location">Detecting...</div>
            <div class="day-nav">
                <button class="nav-btn" onclick="changeDay(-1)">â€¹</button>
                <span id="current-day-label">TODAY</span>
                <button class="nav-btn" onclick="changeDay(1)">â€º</button>
            </div>
            <div id="weather-desc">---</div>
            <div class="temp"><span id="temp-val">--</span>Â°C</div>
            <div class="metrics">
                <div class="metric-card">
                    <div class="metric-title" id="label-uv">UV Index</div>
                    <div class="metric-value" id="uv-val">--</div>
                    <div class="metric-desc" id="uv-info">--</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title" id="label-aqi">Air Quality</div>
                    <div class="metric-value" id="aqi-val">--</div>
                    <div class="metric-desc" id="aqi-info">--</div>
                    <div class="aqi-bar-container"><div id="aqi-bar-fill"></div></div>
                </div>
            </div>
            <div class="advice-box" id="advice">...</div>
            <div class="hourly-scroll" id="hourlyAxis"></div>
        </div>
        <div class="footer-info">AUTHOR: XIA RUI DONG | CONTACT: xiarui091@gmail.com</div>
    </div>

<script>
    const API_KEY = '2a7f5c65709314cf776fb9958f88ceda';
    let currentLang = 'zh_cn';
    let weatherData = null; 
    let currentAQI = 1;
    let dayOffset = 0; 

    // ä½¿ç”¨ä½ æä¾›çš„æœ€æ–° i18n é…ç½®
    const i18n = {
        zh_cn: {
            today: "ä»Šå¤©", tomorrow: "æ˜Žå¤©", d_after: "åŽå¤©", search: "æœç´¢åŸŽå¸‚...", uv: "ç´«å¤–çº¿", aqi: "ç©ºæ°”è´¨é‡", uv_low: "ä½Žè¾å°„", uv_high: "éœ€é˜²æ™’", aqi_good: "ç©ºæ°”æ¸…æ–°", aqi_bad: "æ±¡æŸ“è­¦å‘Š",
            hot: "ðŸ”¥ é…·çƒ­ï¼šç©¿ç€æžç®€ï¼ŒèƒŒå¿ƒçŸ­è£¤ä¸ºå®œã€‚è¯·æ¶‚æŠ¹ SPF50+ é˜²æ™’éœœï¼Œå¤šå–æ°´ä»¥é˜²ä¸­æš‘ã€‚",
            warm: "â˜€ï¸ ç‚Žçƒ­ï¼šå»ºè®®ç©¿æ£‰è´¨çŸ­è¢– T æ¤ã€çŸ­è£™ã€‚å®¤å†…ç©ºè°ƒæˆ¿å¯å¤‡ä¸€ä»¶è¶…è–„è¡¬è¡«é˜²å†·æ°”ã€‚",
            comfortable: "ðŸƒ å®œäººï¼šå•ç©¿é•¿è¢–è¡«ã€T æ¤æˆ–è–„å«è¡£å³å¯ã€‚23Â°C å·¦å³ä½“æ„Ÿéžå¸¸èˆ’é€‚ï¼Œæ— éœ€å¤–å¥—ã€‚",
            chilly: "ðŸŒ¤ï¸ å¾®å‡‰ï¼šéœ€å ç©¿ä¸€ä»¶é˜²é£Žå¤¹å…‹ã€è–„æ¯›è¡£æˆ–é’ˆç»‡å¼€è¡«ã€‚æ—©æ™šæ¸©å·®å¤§ï¼Œè¯·æ³¨æ„ä¿æš–ã€‚",
            cold: "ðŸ§¥ å¯’å†·ï¼šå»ºè®®ç¾Šç»’è¡«æ­é…æ¯›å‘¢å¤§è¡£ï¼Œæˆ–ç©¿ç€ä¿æš–åŽšå¤¹å…‹ã€‚æ­¤æ—¶åº”æˆ´å›´å·¾ä¿æŠ¤é¢ˆéƒ¨ã€‚",
            freezing: "â„ï¸ ä¸¥å¯’ï¼šåŽšé‡ç¾½ç»’æœä¸Žä¿æš–å†…è¡£æ˜¯å¿…å¤‡ã€‚è¯·ä½©æˆ´æ‰‹å¥—å’Œè€³ç½©ï¼Œé˜²æ­¢çš®è‚¤å†»ä¼¤ã€‚",
            rain: " â˜” å‡ºé—¨è¯·åŠ¡å¿…å¸¦ä¼žï¼Œå¹¶ç©¿ç€é˜²æ°´éž‹ç±»ä»¥ä¿æŒå¹²çˆ½ã€‚"
        },
        en: {
            today: "TODAY", tomorrow: "TOMORROW", d_after: "DAY AFTER", search: "Search city...", uv: "UV INDEX", aqi: "AIR QUALITY", uv_low: "Low Risk", uv_high: "Use SPF", aqi_good: "Good Air", aqi_bad: "Pollution",
            hot: "ðŸ”¥ Scorching: Wear light clothing such as tank tops and shorts. Apply SPF 50+ sunscreen and drink plenty of water to prevent heatstroke.",
            warm: "â˜€ï¸ Warm: Cotton short-sleeve T-shirts and skirts are recommended. Keep a light layer handy for air-conditioned spaces.",
            comfortable: "ðŸƒ Pleasant: A long-sleeve shirt, T-shirt, or light hoodie is enough. It feels very comfortable around 23Â°C; no jacket needed.",
            chilly: "ðŸŒ¤ï¸ Chilly: Layer up with a windbreaker, light sweater, or cardigan. Watch out for cooler temperatures in the evening.",
            cold: "ðŸ§¥ Cold: A cashmere sweater with a wool coat or a thick jacket is recommended. Wear a scarf to protect your neck.",
            freezing: "â„ï¸ Freezing: A heavy puffer jacket and thermal underwear are essential. Wear gloves and earmuffs to prevent frostbite.",
            rain: " â˜” Bring an umbrella and wear waterproof shoes to stay dry."
        },
        es: {
            today: "HOY", tomorrow: "MAÃ‘ANA", d_after: "PASADO", search: "Buscar ciudad...", uv: "ÃNDICE UV", aqi: "CALIDAD DEL AIRE", uv_low: "Riesgo Bajo", uv_high: "Usa SPF", aqi_good: "Aire Limpio", aqi_bad: "Contaminado",
            hot: "ðŸ”¥ Abrasador: Lleve ropa lo mÃ¡s ligera posible, como camisetas sin mangas y pantalones cortos. Aplique protector solar SPF 50+ y beba abundante agua para evitar golpes de calor.",
            warm: "â˜€ï¸ CÃ¡lido: Se recomiendan camisetas de algodÃ³n de manga corta y faldas. Tenga a mano una prenda ligera para interiores con aire acondicionado.",
            comfortable: "ðŸƒ Agradable: Una camisa de manga larga, camiseta o sudadera ligera es suficiente. Se siente muy cÃ³modo a unos 23Â°C; no se necesita chaqueta.",
            chilly: "ðŸŒ¤ï¸ Fresco: VÃ­stase por capas con un cortavientos o un suÃ©ter ligero. Tenga en cuenta la bajada de temperatura por la noche.",
            cold: "ðŸ§¥ FrÃ­o: Se recomienda un suÃ©ter de cachemir con un abrigo de lana o una chaqueta gruesa. Use una bufanda para proteger el cuello.",
            freezing: "â„ï¸ GÃ©lido: Un abrigo de plumas grueso y ropa tÃ©rmica son esenciales. Use guantes y orejeras para evitar la congelaciÃ³n.",
            rain: " â˜” Lleve paraguas y use calzado impermeable para mantenerse seco."
        },
        fr: {
            today: "AUJOURD'HUI", tomorrow: "DEMAIN", d_after: "APRÃˆS-DEMAIN", search: "Chercher...", uv: "INDICE UV", aqi: "QUALITÃ‰ DE L'AIR", uv_low: "Bas", uv_high: "Protection", aqi_good: "Air Pur", aqi_bad: "Pollution",
            hot: "ðŸ”¥ Canicule : Portez des vÃªtements lÃ©gers comme des dÃ©bardeurs. Appliquez de la crÃ¨me solaire SPF 50+ et buvez beaucoup d'eau.",
            warm: "â˜€ï¸ Chaud : Des t-shirts en coton et des jupes sont recommandÃ©s. PrÃ©voyez une couche lÃ©gÃ¨re pour les piÃ¨ces climatisÃ©es.",
            comfortable: "ðŸƒ AgrÃ©able : Un t-shirt Ã  manches longues ou un sweat lÃ©ger suffit. Ã€ 23Â°C, c'est trÃ¨s confortable ; pas besoin de veste.",
            chilly: "ðŸŒ¤ï¸ Frais : Superposez un coupe-vent ou un pull lÃ©ger. Attention Ã  la baisse de tempÃ©rature en soirÃ©e.",
            cold: "ðŸ§¥ Froid : Un pull en cachemire avec un manteau en laine est recommandÃ©. Portez une Ã©charpe pour protÃ©ger votre cou.",
            freezing: "â„ï¸ Gel : Une doudoune Ã©paisse et des sous-vÃªtements thermiques sont indispensables. Portez des gants et des cache-oreilles.",
            rain: " â˜” N'oubliez pas votre parapluie et portez des chaussures impermÃ©ables pour rester au sec."
        },
        de: {
            today: "HEUTE", tomorrow: "MORGEN", d_after: "ÃœBERMORGEN", search: "Stadt suchen...", uv: "UV INDEX", aqi: "LUFTQUALITÃ„T", uv_low: "Niedrig", uv_high: "Schutz", aqi_good: "Gute Luft", aqi_bad: "Belastung",
            hot: "ðŸ”¥ Hitze: Tragen Sie leichte Kleidung wie Tanktops und Shorts. Verwenden Sie Sonnencreme mit SPF 50+ und trinken Sie viel Wasser.",
            warm: "â˜€ï¸ Warm: Baumwoll-T-Shirts und RÃ¶cke werden empfohlen. Halten Sie eine leichte Schicht fÃ¼r klimatisierte RÃ¤ume bereit.",
            comfortable: "ðŸƒ Angenehm: Ein Langarmshirt oder ein leichter Hoodie reicht aus. Bei ca. 23Â°C ist es sehr angenehm; keine Jacke nÃ¶tig.",
            chilly: "ðŸŒ¤ï¸ KÃ¼hl: Ziehen Sie sich im Zwiebellook mit Windjacke oder leichtem Pullover an. Achten Sie auf kÃ¼hlere Temperaturen am Abend.",
            cold: "ðŸ§¥ Kalt: Ein Kaschmirpullover mit Wollmantel oder eine dicke Jacke wird empfohlen. Tragen Sie einen Schal zum Schutz des Halses.",
            freezing: "â„ï¸ Eiskalt: Eine dicke Daunenjacke und ThermounterwÃ¤sche sind wichtig. Tragen Sie Handschuhe und OhrenschÃ¼tzer.",
            rain: " â˜” Nehmen Sie einen Regenschirm mit und tragen Sie wasserfeste Schuhe, um trocken zu bleiben."
        },
        ru: {
            today: "Ð¡Ð•Ð“ÐžÐ”ÐÐ¯", tomorrow: "Ð—ÐÐ’Ð¢Ð Ð", d_after: "ÐŸÐžÐ¡Ð›Ð•Ð—ÐÐ’Ð¢Ð Ð", search: "ÐŸÐ¾Ð¸ÑÐº...", uv: "Ð£Ð¤-Ð˜ÐÐ”Ð•ÐšÐ¡", aqi: "ÐšÐÐ§Ð•Ð¡Ð¢Ð’Ðž Ð’ÐžÐ—Ð”Ð£Ð¥Ð", uv_low: "ÐÐ¸Ð·ÐºÐ¸Ð¹", uv_high: "Ð—Ð°Ñ‰Ð¸Ñ‚Ð°", aqi_good: "Ð§Ð¸ÑÑ‚Ð¾", aqi_bad: "Ð—Ð°Ð³Ñ€ÑÐ·Ð½ÐµÐ½Ð¸Ðµ",
            hot: "ðŸ”¥ Ð–Ð°Ñ€Ð°: ÐÐ¾ÑÐ¸Ñ‚Ðµ Ð»Ñ‘Ð³ÐºÑƒÑŽ Ð¾Ð´ÐµÐ¶Ð´Ñƒ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¼Ð°Ð¹ÐºÑƒ Ð¸ ÑˆÐ¾Ñ€Ñ‚Ñ‹. ÐÐ°Ð½ÐµÑÐ¸Ñ‚Ðµ ÑÐ¾Ð»Ð½Ñ†ÐµÐ·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ð¹ ÐºÑ€ÐµÐ¼ SPF 50+ Ð¸ Ð¿ÐµÐ¹Ñ‚Ðµ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð²Ð¾Ð´Ñ‹.",
            warm: "â˜€ï¸ Ð¢ÐµÐ¿Ð»Ð¾: Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÑŽÑ‚ÑÑ Ñ…Ð»Ð¾Ð¿ÐºÐ¾Ð²Ñ‹Ðµ Ñ„ÑƒÑ‚Ð±Ð¾Ð»ÐºÐ¸ Ð¸ ÑŽÐ±ÐºÐ¸. Ð”ÐµÑ€Ð¶Ð¸Ñ‚Ðµ Ð»Ñ‘Ð³ÐºÑƒÑŽ Ð½Ð°ÐºÐ¸Ð´ÐºÑƒ Ð´Ð»Ñ Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ð¹ Ñ ÐºÐ¾Ð½Ð´Ð¸Ñ†Ð¸Ð¾Ð½ÐµÑ€Ð¾Ð¼.",
            comfortable: "ðŸƒ ÐŸÑ€Ð¸ÑÑ‚Ð½Ð¾: Ð”Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ñ„ÑƒÑ‚Ð±Ð¾Ð»ÐºÐ¸ Ñ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ð¼ Ñ€ÑƒÐºÐ°Ð²Ð¾Ð¼ Ð¸Ð»Ð¸ Ð»Ñ‘Ð³ÐºÐ¾Ð³Ð¾ ÑÐ²Ð¸Ñ‚ÑˆÐ¾Ñ‚Ð°. ÐŸÑ€Ð¸ 23Â°C Ð¾Ñ‡ÐµÐ½ÑŒ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾; ÐºÑƒÑ€Ñ‚ÐºÐ° Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð°.",
            chilly: "ðŸŒ¤ï¸ ÐŸÑ€Ð¾Ñ…Ð»Ð°Ð´Ð½Ð¾: ÐžÐ´ÐµÐ²Ð°Ð¹Ñ‚ÐµÑÑŒ ÑÐ»Ð¾ÑÐ¼Ð¸ â€” Ð²ÐµÑ‚Ñ€Ð¾Ð²ÐºÐ° Ð¸Ð»Ð¸ Ð»Ñ‘Ð³ÐºÐ¸Ð¹ ÑÐ²Ð¸Ñ‚ÐµÑ€ Ð¿Ð¾Ð´Ð¾Ð¹Ð´ÑƒÑ‚. Ð£Ñ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ…Ð¾Ð»Ð¾Ð´Ð°Ð½Ð¸Ðµ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼.",
            cold: "ðŸ§¥ Ð¥Ð¾Ð»Ð¾Ð´Ð½Ð¾: Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ ÐºÐ°ÑˆÐµÐ¼Ð¸Ñ€Ð¾Ð²Ñ‹Ð¹ ÑÐ²Ð¸Ñ‚ÐµÑ€ Ñ ÑˆÐµÑ€ÑÑ‚ÑÐ½Ñ‹Ð¼ Ð¿Ð°Ð»ÑŒÑ‚Ð¾ Ð¸Ð»Ð¸ Ñ‚Ñ‘Ð¿Ð»Ð°Ñ ÐºÑƒÑ€Ñ‚ÐºÐ°. ÐÐ°Ð´ÐµÐ½ÑŒÑ‚Ðµ ÑˆÐ°Ñ€Ñ„ Ð´Ð»Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ ÑˆÐµÐ¸.",
            freezing: "â„ï¸ ÐœÐ¾Ñ€Ð¾Ð·: Ð¢Ñ‘Ð¿Ð»Ñ‹Ð¹ Ð¿ÑƒÑ…Ð¾Ð²Ð¸Ðº Ð¸ Ñ‚ÐµÑ€Ð¼Ð¾Ð±ÐµÐ»ÑŒÑ‘ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹. ÐÐ°Ð´ÐµÐ½ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ñ‡Ð°Ñ‚ÐºÐ¸ Ð¸ Ñ‚Ñ‘Ð¿Ð»ÑƒÑŽ ÑˆÐ°Ð¿ÐºÑƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ Ð¾Ð±Ð¼Ð¾Ñ€Ð¾Ð¶ÐµÐ½Ð¸Ñ.",
            rain: " â˜” Ð’Ð¾Ð·ÑŒÐ¼Ð¸Ñ‚Ðµ Ð·Ð¾Ð½Ñ‚ Ð¸ Ð½Ð°Ð´ÐµÐ½ÑŒÑ‚Ðµ Ð½ÐµÐ¿Ñ€Ð¾Ð¼Ð¾ÐºÐ°ÐµÐ¼ÑƒÑŽ Ð¾Ð±ÑƒÐ²ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ñ‚ÑŒÑÑ ÑÑƒÑ…Ð¸Ð¼."
        },
        ar: {
            today: "Ø§Ù„ÙŠÙˆÙ…", tomorrow: "ØºØ¯Ø§Ù‹", d_after: "Ø¨Ø¹Ø¯ ØºØ¯", search: "Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†Ø©...", uv: "Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø´Ø¹Ø© ÙÙˆÙ‚ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠØ©", aqi: "Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡", uv_low: "Ù…Ù†Ø®ÙØ¶", uv_high: "Ø§Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù‚ÙŠ Ø´Ù…Ø³", aqi_good: "Ù‡ÙˆØ§Ø¡ Ù†Ù‚ÙŠ", aqi_bad: "ØªÙ„ÙˆØ«",
            hot: "ðŸ”¥ Ø­Ø±Ø§Ø±Ø© Ø´Ø¯ÙŠØ¯Ø©: Ø§Ø±ØªØ¯Ù Ù…Ù„Ø§Ø¨Ø³ Ø®ÙÙŠÙØ© Ù…Ø«Ù„ Ø§Ù„Ù‚Ù…ØµØ§Ù† Ø¨Ø¯ÙˆÙ† Ø£ÙƒÙ…Ø§Ù… ÙˆØ§Ù„Ø³Ø±Ø§ÙˆÙŠÙ„ Ø§Ù„Ù‚ØµÙŠØ±Ø©. Ø¶Ø¹ ÙˆØ§Ù‚ÙŠ Ø´Ù…Ø³ SPF 50+ ÙˆØ§Ø´Ø±Ø¨ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø§Ø¡.",
            warm: "â˜€ï¸ Ø¯Ø§ÙØ¦: ÙŠÙÙ†ØµØ­ Ø¨Ø§Ø±ØªØ¯Ø§Ø¡ Ù‚Ù…ØµØ§Ù† Ù‚Ø·Ù†ÙŠØ© Ø¨Ø£ÙƒÙ…Ø§Ù… Ù‚ØµÙŠØ±Ø© ÙˆØªÙ†Ø§Ù†ÙŠØ±. Ø§Ø­ØªÙØ¸ Ø¨Ø·Ø¨Ù‚Ø© Ø®ÙÙŠÙØ© Ù„Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…ÙƒÙŠÙØ©.",
            comfortable: "ðŸƒ Ù„Ø·ÙŠÙ: ÙŠÙƒÙÙŠ Ù‚Ù…ÙŠØµ Ø¨Ø£ÙƒÙ…Ø§Ù… Ø·ÙˆÙŠÙ„Ø© Ø£Ùˆ Ø³ØªØ±Ø© Ø®ÙÙŠÙØ©. Ø§Ù„Ø¬Ùˆ Ù…Ø±ÙŠØ­ Ø¬Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ 23 Ø¯Ø±Ø¬Ø© Ù…Ø¦ÙˆÙŠØ©Ø› Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø³ØªØ±Ø©.",
            chilly: "ðŸŒ¤ï¸ Ø¨Ø§Ø±Ø¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹: Ø§Ø±ØªØ¯Ù Ù…Ù„Ø§Ø¨Ø³ Ø¹Ù„Ù‰ Ø·Ø¨Ù‚Ø§Øª Ù…Ø¹ Ø³ØªØ±Ø© Ø®ÙÙŠÙØ©. Ø§Ù†ØªØ¨Ù‡ Ù„Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¡.",
            cold: "ðŸ§¥ Ø¨Ø§Ø±Ø¯: ÙŠÙÙØ¶Ù„ Ø§Ø±ØªØ¯Ø§Ø¡ ÙƒÙ†Ø²Ø© ÙƒØ´Ù…ÙŠØ± Ù…Ø¹ Ù…Ø¹Ø·Ù ØµÙˆÙ Ø£Ùˆ Ø³ØªØ±Ø© Ø³Ù…ÙŠÙƒØ©. Ø§Ø±ØªØ¯Ù ÙˆØ´Ø§Ø­Ø§Ù‹ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±Ù‚Ø¨Ø©.",
            freezing: "â„ï¸ Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø±ÙˆØ¯Ø©: Ù…Ø¹Ø·Ù Ø´ØªÙˆÙŠ Ø«Ù‚ÙŠÙ„ ÙˆÙ…Ù„Ø§Ø¨Ø³ Ø­Ø±Ø§Ø±ÙŠØ© Ø¶Ø±ÙˆØ±ÙŠØ©. Ø§Ø±ØªØ¯Ù Ù‚ÙØ§Ø²Ø§Øª ÙˆØºØ·Ø§Ø¡ Ù„Ù„Ø±Ø£Ø³ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØµÙ‚ÙŠØ¹.",
            rain: " â˜” Ø£Ø­Ø¶Ø± Ù…Ø¸Ù„Ø© ÙˆØ§Ø±ØªØ¯Ù Ø£Ø­Ø°ÙŠØ© Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ù…Ø§Ø¡ Ù„Ù„Ø¨Ù‚Ø§Ø¡ Ø¬Ø§ÙØ§Ù‹."
        }
    };

    window.onload = () => {
        updatePlaceholder();
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => fetchAllWeather(p.coords.latitude, p.coords.longitude), () => searchCity('Madrid'));
        } else { searchCity('Madrid'); }
    };

    document.getElementById('cityInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') searchCity(e.target.value); });

    async function searchCity(city) {
        if (!city) return;
        try {
            const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${API_KEY}`);
            const geo = await res.json();
            if (geo && geo.length > 0) fetchAllWeather(geo[0].lat, geo[0].lon);
        } catch (e) { console.error(e); }
    }

    async function fetchAllWeather(lat, lon) {
        try {
            const fRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${currentLang}`);
            weatherData = await fRes.json();
            const aRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
            const aqiData = await aRes.json();
            currentAQI = aqiData.list[0].main.aqi;
            updateDisplay();
        } catch (e) { console.error(e); }
    }

    function updateDisplay() {
        if (!weatherData) return;
        document.getElementById('location').innerText = weatherData.city.name.toUpperCase();
        document.getElementById('current-day-label').innerText = [i18n[currentLang].today, i18n[currentLang].tomorrow, i18n[currentLang].d_after][dayOffset];
        const scroll = document.getElementById('hourlyAxis');
        scroll.innerHTML = '';
        const targetDate = new Date();
        targetDate.setDate(targetDate.getDate() + dayOffset);
        const dateStr = targetDate.toISOString().split('T')[0];
        
        let displayList = weatherData.list.filter(item => item.dt_txt.includes(dateStr));
        if (displayList.length < 5) {
            const startIndex = weatherData.list.findIndex(item => item.dt_txt.includes(dateStr));
            displayList = weatherData.list.slice(startIndex >= 0 ? startIndex : 0, (startIndex >= 0 ? startIndex : 0) + 8);
        }
        const focusData = displayList[0];
        
        setBackground(focusData.weather[0].main, focusData.weather[0].description, focusData.weather[0].id);

        const temp = Math.round(focusData.main.temp);
        const uvValue = Math.max(1, Math.min(11, Math.floor(temp / 4) + (focusData.weather[0].main === 'Clear' ? 2 : 0)));
        
        document.getElementById('temp-val').innerText = temp;
        document.getElementById('weather-desc').innerText = focusData.weather[0].description;
        document.getElementById('uv-val').innerText = uvValue;
        document.getElementById('aqi-val').innerText = currentAQI;
        document.getElementById('label-uv').innerText = i18n[currentLang].uv;
        document.getElementById('label-aqi').innerText = i18n[currentLang].aqi;
        document.getElementById('uv-info').innerText = uvValue > 5 ? i18n[currentLang].uv_high : i18n[currentLang].uv_low;
        document.getElementById('aqi-info').innerText = currentAQI > 2 ? i18n[currentLang].aqi_bad : i18n[currentLang].aqi_good;

        const aqiBar = document.getElementById('aqi-bar-fill');
        const colors = ["#4ade80", "#a3e635", "#fde047", "#fb923c", "#ef4444"];
        aqiBar.style.width = (currentAQI * 20) + "%";
        aqiBar.style.backgroundColor = colors[currentAQI - 1] || "#4ade80";

        let key = temp >= 32 ? 'hot' : temp >= 27 ? 'warm' : temp >= 20 ? 'comfortable' : temp >= 12 ? 'chilly' : temp >= 0 ? 'cold' : 'freezing';
        document.getElementById('advice').innerText = i18n[currentLang][key] + (focusData.weather[0].main.includes('Rain') ? i18n[currentLang].rain : "");

        displayList.forEach((item, idx) => {
            const time = item.dt_txt.split(' ')[1].substring(0, 5);
            scroll.innerHTML += `<div class="hour-item ${idx===0?'active':''}">
                <div class="hour-time">${time}</div>
                <img src="https://openweathermap.org/img/wn/${item.weather[0].icon}.png" width="35">
                <div class="hour-temp">${Math.round(item.main.temp)}Â°</div>
            </div>`;
        });
    }

    function changeDay(step) {
        dayOffset = Math.max(0, Math.min(2, dayOffset + step));
        if(weatherData) updateDisplay();
    }

    function setBackground(main, description, id) {
        const wrapper = document.getElementById('bg-wrapper');
        wrapper.innerHTML = '';
        const body = document.body;
        
        if (main === 'Clear') {
            body.style.backgroundColor = "#1a8fff";
            const s = document.createElement('div'); s.className = 'sun-glow'; wrapper.appendChild(s);
        } else if (main === 'Snow') {
            body.style.backgroundColor = "#1e2732"; 
            let count = 80; let speed = 5; let size = 5;
            if (id === 602 || id === 622) { count = 250; speed = 2.5; size = 9; }
            else if (id === 600 || id === 620) { count = 35; speed = 10; size = 3; }

            for(let i=0; i<count; i++) {
                let s = document.createElement('div'); s.className = 'snow';
                s.style.left = Math.random()*100+'vw';
                s.style.width = s.style.height = (Math.random()*size + 2)+'px';
                s.style.animationDuration = (speed + Math.random()*speed)+'s';
                wrapper.appendChild(s);
            }
        } else if (main === 'Rain' || main === 'Drizzle') {
            body.style.backgroundColor = "#3d4e5f";
            let count = 100; let speed = 0.7; let width = 2;
            if (id >= 502 && id <= 504) { count = 300; speed = 0.35; width = 4; }
            else if (id === 500 || main === 'Drizzle') { count = 40; speed = 1.5; width = 1; }
            
            for(let i=0; i<count; i++) {
                let d = document.createElement('div'); d.className = 'rain';
                d.style.left = Math.random()*100+'vw'; 
                d.style.width = width + 'px';
                d.style.animationDuration = (speed + Math.random()*speed/2)+'s';
                wrapper.appendChild(d);
            }
        } else {
            body.style.backgroundColor = "#607d8b";
            for(let i=0; i<3; i++) {
                let c = document.createElement('div'); c.className = 'cloud';
                c.style.top = (20+i*20)+'vh'; c.style.width = '350px'; c.style.height = '180px';
                c.style.animationDuration = (20+Math.random()*15)+'s'; wrapper.appendChild(c);
            }
        }
    }

    function changeLanguage() {
        currentLang = document.getElementById('langSelect').value;
        document.body.className = (currentLang === 'ar') ? 'rtl' : '';
        updatePlaceholder();
        if (weatherData) fetchAllWeather(weatherData.city.coord.lat, weatherData.city.coord.lon);
    }
    function updatePlaceholder() { document.getElementById('cityInput').placeholder = i18n[currentLang].search; }
</script>
</body>
</html>
