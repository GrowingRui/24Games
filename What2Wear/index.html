<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What2Wear - Full Multi-Language</title>
    <style>
        :root { 
            --glass: rgba(255, 255, 255, 0.15); 
            --border: rgba(255, 255, 255, 0.25);
            --bg-speed: 1.5s;
        }
        * { box-sizing: border-box; }
        /* ‰øùÊåÅ‰øÆÂ§çÔºöÂàùÂßãËÉåÊôØËâ≤Èò≤Ê≠¢ÁôΩÂ±è */
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            color: white; overflow: hidden; 
            background-color: #2c3e50; 
        }
        body.rtl { direction: rtl; }
        
        #bg-wrapper { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; 
            transition: background var(--bg-speed) ease-in-out, filter 1s ease; 
        }
        
        .sun-glow { 
            position: absolute; top: -10%; right: -10%; width: 70vw; height: 70vw; 
            background: radial-gradient(circle, rgba(255,255,150,0.3) 0%, rgba(255,255,255,0) 70%); 
            animation: pulse 6s infinite alternate; 
        }
        .moon-glow {
            position: absolute; top: 5%; left: 10%; width: 50vw; height: 50vw; 
            background: radial-gradient(circle, rgba(200,220,255,0.2) 0%, rgba(255,255,255,0) 60%); 
            animation: pulse 8s infinite alternate;
        }
        @keyframes pulse { from { opacity: 0.4; transform: scale(1); } to { opacity: 0.7; transform: scale(1.1); } }
        
        .rain { position: absolute; background: rgba(255,255,255,0.4); height: 20px; top: -30px; animation: fall linear infinite; }
        .snow { position: absolute; background: white; border-radius: 50%; opacity: 0.8; top: -10px; animation: snowFall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh) translateX(var(--wind-offset, 0px)); } }
        @keyframes snowFall { to { transform: translateY(110vh) translateX(calc(20px + var(--wind-offset, 0px))); } }
        
        .cloud { position: absolute; background: rgba(255,255,255,0.4); filter: blur(40px); border-radius: 50%; animation: drift linear infinite; }
        @keyframes drift { from { left: -400px; } to { left: 120vw; } }

        #app-content { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 15px; }
        
        .container { 
            background: var(--glass); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); 
            padding: 25px; border-radius: 40px; text-align: center; width: 100%; max-width: 480px; 
            border: 1px solid var(--border); box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s ease;
            position: relative;
        }
        .container.loading { opacity: 0.5; transform: scale(0.95) translateY(20px); filter: blur(5px); }

        .city-selector {
            position: absolute; top: 70px; left: 25px; right: 25px; 
            background: rgba(0,0,0,0.85); border-radius: 20px; z-index: 100;
            max-height: 200px; overflow-y: auto; display: none; border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .city-option { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.2s; font-size: 0.85rem; text-align: left; }
        body.rtl .city-option { text-align: right; }
        .city-option:hover { background: rgba(255,255,255,0.2); }
        .city-option:last-child { border-bottom: none; }

        .header-tools { display: flex; gap: 10px; margin-bottom: 15px; }
        .search-box { flex: 1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 20px; padding: 8px 15px; color: white; outline: none; }
        
        .lang-selector { background: rgba(0,0,0,0.5); color: white; border: 1px solid var(--border); padding: 8px; border-radius: 20px; }
        .day-nav { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 5px 0; font-weight: bold; }
        .nav-btn { cursor: pointer; background: none; border: none; color: white; font-size: 1.5rem; opacity: 0.7; transition: 0.3s; }
        .nav-btn:hover { opacity: 1; transform: scale(1.2); }

        .metrics { display: flex; justify-content: center; gap: 12px; margin: 15px 0; }
        .metric-card { background: rgba(0,0,0,0.25); padding: 12px 10px; border-radius: 18px; flex: 1; min-width: 100px; position: relative; }
        .metric-title { font-size: 0.7rem; opacity: 0.8; margin-bottom: 2px; text-transform: uppercase; }
        .metric-value { font-size: 1.1rem; font-weight: bold; }
        .metric-desc { font-size: 0.65rem; margin-top: 5px; padding: 3px; border-radius: 6px; background: rgba(255,255,255,0.12); }
        
        .bar-container { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; transition: 1s cubic-bezier(0.1, 0.7, 0.1, 1); border-radius: 2px; }
        
        .temp { font-size: 4.5rem; font-weight: 100; margin: 0; letter-spacing: -2px; }
        .advice-box { background: rgba(0,0,0,0.15); border-radius: 20px; padding: 18px; font-size: 0.85rem; line-height: 1.6; margin: 15px 0; min-height: 125px; text-align: left; }
        body.rtl .advice-box { text-align: right; }
        
        .hourly-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 15px 5px; margin-top: 10px; border-top: 1px solid var(--border); }
        .hour-item { min-width: 60px; text-align: center; border-radius: 10px; padding: 5px; flex-shrink: 0; }
        .hour-item.active { background: rgba(255,255,255,0.15); border: 1px solid var(--border); }
        
        .footer-info { position: absolute; bottom: 10px; font-size: 9px; opacity: 0.5; width: 100%; text-align: center; pointer-events: none; }
    </style>
</head>
<body>
    <div id="bg-wrapper"></div>
    <div id="app-content">
        <div class="container" id="mainContainer">
            <div id="citySelector" class="city-selector"></div>
            <div class="header-tools">
                <input type="text" id="cityInput" class="search-box">
                <select class="lang-selector" id="langSelect" onchange="changeLanguage()">
                    <option value="zh_cn">CN</option>
                    <option value="en">EN</option>
                    <option value="es">ES</option>
                    <option value="de">DE</option>
                    <option value="fr">FR</option>
                    <option value="ru">RU</option>
                    <option value="ar">AR</option>
                </select>
            </div>
            <div id="location" style="letter-spacing: 2px; font-weight: 600;">Detecting...</div>
            <div class="day-nav">
                <button class="nav-btn" onclick="changeDay(-1)">‚Äπ</button>
                <span id="current-day-label">TODAY</span>
                <button class="nav-btn" onclick="changeDay(1)">‚Ä∫</button>
            </div>
            <div id="weather-desc" style="text-transform: capitalize; opacity: 0.9;">---</div>
            <div class="temp"><span id="temp-val">--</span>¬∞C</div>
            <div class="metrics">
                <div class="metric-card">
                    <div class="metric-title" id="label-uv">UV Index</div>
                    <div class="metric-value" id="uv-val">--</div>
                    <div class="metric-desc" id="uv-info">--</div>
                    <div class="bar-container"><div id="uv-bar-fill" class="bar-fill"></div></div>
                </div>
                <div class="metric-card">
                    <div class="metric-title" id="label-aqi">Air Quality</div>
                    <div class="metric-value" id="aqi-val">--</div>
                    <div class="metric-desc" id="aqi-info">--</div>
                    <div class="bar-container"><div id="aqi-bar-fill" class="bar-fill"></div></div>
                </div>
            </div>
            <div class="advice-box" id="advice">...</div>
            <div class="hourly-scroll" id="hourlyAxis"></div>
        </div>
        <div class="footer-info">AUTHOR: XIA RUI DONG | CONTACT: xiarui091@gmail.com</div>
    </div>

<script>
    const API_KEY = '2a7f5c65709314cf776fb9958f88ceda';
    let currentLang = 'zh_cn';
    let weatherData = null; 
    let currentAQI = 1;
    let dayOffset = 0; 

    const i18n = {
        zh_cn: {
            today: "‰ªäÂ§©", tomorrow: "ÊòéÂ§©", d_after: "ÂêéÂ§©", search: "ÊêúÁ¥¢ÂüéÂ∏Ç...", uv: "Á¥´Â§ñÁ∫ø", aqi: "Á©∫Ê∞îË¥®Èáè", uv_low: "‰ΩéËæêÂ∞Ñ", uv_high: "ÈúÄÈò≤Êôí", aqi_good: "Á©∫Ê∞îÊ∏ÖÊñ∞", aqi_bad: "Ê±°ÊüìË≠¶Âëä",
            not_found: "üìç Êú™ÊâæÂà∞ËØ•Âú∞ÁÇπ", select_city: "ËØ∑ÈÄâÊã©Á°ÆÂàáÂú∞ÁÇπÔºö",
            hot: "üî• ÈÖ∑ÁÉ≠ÔºöÁ©øÁùÄÊûÅÁÆÄÔºåËÉåÂøÉÁü≠Ë£§‰∏∫ÂÆú„ÄÇËØ∑Ê∂ÇÊäπ SPF50+ Èò≤ÊôíÈúúÔºåÂ§öÂñùÊ∞¥‰ª•Èò≤‰∏≠Êöë„ÄÇ",
            warm: "‚òÄÔ∏è ÁÇéÁÉ≠ÔºöÂª∫ËÆÆÁ©øÊ£âË¥®Áü≠Ë¢ñ T ÊÅ§„ÄÅÁü≠Ë£ô„ÄÇÂÆ§ÂÜÖÁ©∫Ë∞ÉÊàøÂèØÂ§á‰∏Ä‰ª∂Ë∂ÖËñÑË°¨Ë°´Èò≤ÂÜ∑Ê∞î„ÄÇ",
            comfortable: "üçÉ ÂÆú‰∫∫ÔºöÂçïÁ©øÈïøË¢ñË°´„ÄÅT ÊÅ§ÊàñËñÑÂç´Ë°£Âç≥ÂèØ„ÄÇ23¬∞C Â∑¶Âè≥‰ΩìÊÑüÈùûÂ∏∏ËàíÈÄÇÔºåÊó†ÈúÄÂ§ñÂ•ó„ÄÇ",
            chilly: "üå§Ô∏è ÂæÆÂáâÔºöÈúÄÂè†Á©ø‰∏Ä‰ª∂Èò≤È£éÂ§πÂÖã„ÄÅËñÑÊØõË°£ÊàñÈíàÁªáÂºÄË°´„ÄÇÊó©ÊôöÊ∏©Â∑ÆÂ§ßÔºåËØ∑Ê≥®ÊÑè‰øùÊöñ„ÄÇ",
            cold: "üß• ÂØíÂÜ∑ÔºöÂª∫ËÆÆÁæäÁªíË°´Êê≠ÈÖçÊØõÂë¢Â§ßË°£ÔºåÊàñÁ©øÁùÄ‰øùÊöñÂéöÂ§πÂÖã„ÄÇÊ≠§Êó∂Â∫îÊà¥Âõ¥Â∑æ‰øùÊä§È¢àÈÉ®„ÄÇ",
            freezing: "‚ùÑÔ∏è ‰∏•ÂØíÔºöÂéöÈáçÁæΩÁªíÊúç‰∏é‰øùÊöñÂÜÖË°£ÊòØÂøÖÂ§á„ÄÇËØ∑‰Ω©Êà¥ÊâãÂ•óÂíåËÄ≥ÁΩ©ÔºåÈò≤Ê≠¢ÁöÆËÇ§ÂÜª‰º§„ÄÇ",
            rain: " ‚òî Âá∫Èó®ËØ∑Âä°ÂøÖÂ∏¶‰ºûÔºåÂπ∂Á©øÁùÄÈò≤Ê∞¥ÈûãÁ±ª‰ª•‰øùÊåÅÂπ≤ÁàΩ„ÄÇ"
        },
        en: {
            today: "TODAY", tomorrow: "TOMORROW", d_after: "DAY AFTER", search: "Search city...", uv: "UV INDEX", aqi: "AIR QUALITY", uv_low: "Low Risk", uv_high: "Use SPF", aqi_good: "Good Air", aqi_bad: "Pollution",
            not_found: "üìç Location Not Found", select_city: "Select exact location:",
            hot: "üî• Scorching: Wear light clothing. Apply SPF 50+ and drink water to prevent heatstroke.",
            warm: "‚òÄÔ∏è Warm: Cotton T-shirts and skirts recommended. Keep a light layer handy for A/C.",
            comfortable: "üçÉ Pleasant: A long-sleeve shirt or light hoodie is enough. No jacket needed.",
            chilly: "üå§Ô∏è Chilly: Layer up with a windbreaker or cardigan. Watch out for cooler evenings.",
            cold: "üß• Cold: A wool coat or thick jacket is recommended. Wear a scarf to protect your neck.",
            freezing: "‚ùÑÔ∏è Freezing: A heavy puffer jacket and thermals are essential. Wear gloves and earmuffs.",
            rain: " ‚òî Bring an umbrella and wear waterproof shoes to stay dry."
        },
        es: {
            today: "HOY", tomorrow: "MA√ëANA", d_after: "PASADO", search: "Buscar...", uv: "√çNDICE UV", aqi: "CALIDAD DEL AIRE", uv_low: "Riesgo Bajo", uv_high: "Usa SPF", aqi_good: "Aire Limpio", aqi_bad: "Contaminado",
            not_found: "üìç Ubicaci√≥n no encontrada", select_city: "Seleccione ubicaci√≥n exacta:",
            hot: "üî• Abrasador: Lleve ropa ligera. Aplique protector SPF 50+ y beba mucha agua.",
            warm: "‚òÄÔ∏è C√°lido: Camisetas de algod√≥n. Tenga algo ligero para el aire acondicionado.",
            comfortable: "üçÉ Agradable: Una camisa de manga larga o sudadera es suficiente. Muy c√≥modo.",
            chilly: "üå§Ô∏è Fresco: V√≠stase por capas con un cortavientos o su√©ter. Cuidado por la noche.",
            cold: "üß• Fr√≠o: Abrigo de lana o chaqueta gruesa. Use bufanda para proteger el cuello.",
            freezing: "‚ùÑÔ∏è G√©lido: Abrigo de plumas y ropa t√©rmica son esenciales. Use guantes.",
            rain: " ‚òî Lleve paraguas y calzado impermeable para no mojarse."
        },
        fr: {
            today: "AUJOURD'HUI", tomorrow: "DEMAIN", d_after: "APR√àS-DEMAIN", search: "Chercher...", uv: "INDICE UV", aqi: "QUALIT√â DE L'AIR", uv_low: "Bas", uv_high: "Protection", aqi_good: "Air Pur", aqi_bad: "Pollution",
            not_found: "üìç Lieu non trouv√©", select_city: "Choisissez le lieu exact :",
            hot: "üî• Canicule : V√™tements l√©gers. Appliquez SPF 50+ et buvez beaucoup d'eau.",
            warm: "‚òÄÔ∏è Chaud : T-shirts en coton. Pr√©voyez une couche pour les lieux climatis√©s.",
            comfortable: "üçÉ Agr√©able : Un t-shirt manches longues ou sweat suffit. Tr√®s confortable.",
            chilly: "üå§Ô∏è Frais : Superposez un coupe-vent ou un pull l√©ger. Attention en soir√©e.",
            cold: "üß• Froid : Manteau en laine ou veste √©paisse. Portez une √©charpe.",
            freezing: "‚ùÑÔ∏è Gel : Doudoune √©paisse et v√™tements thermiques requis. Portez des gants.",
            rain: " ‚òî Apportez un parapluie et des chaussures imperm√©ables."
        },
        de: {
            today: "HEUTE", tomorrow: "MORGEN", d_after: "√úBERMORGEN", search: "Suchen...", uv: "UV INDEX", aqi: "LUFTQUALIT√ÑT", uv_low: "Niedrig", uv_high: "Schutz", aqi_good: "Gute Luft", aqi_bad: "Belastung",
            not_found: "üìç Ort nicht gefunden", select_city: "W√§hlen Sie den genauen Ort:",
            hot: "üî• Hitze: Leichte Kleidung. SPF 50+ nutzen und viel Wasser trinken.",
            warm: "‚òÄÔ∏è Warm: Baumwoll-T-Shirts. Leichte Schicht f√ºr klimatisierte R√§ume.",
            comfortable: "üçÉ Angenehm: Langarmshirt oder leichter Hoodie reicht v√∂llig aus.",
            chilly: "üå§Ô∏è K√ºhl: Zwiebelprinzip mit Windjacke oder Pullover. Abends wird es k√ºhl.",
            cold: "üß• Kalt: Wollmantel oder dicke Jacke. Schal zum Schutz des Halses tragen.",
            freezing: "‚ùÑÔ∏è Eiskalt: Daunenjacke und Thermounterw√§sche sind wichtig.",
            rain: " ‚òî Regenschirm und wasserfeste Schuhe mitnehmen, um trocken zu bleiben."
        },
        ru: {
            today: "–°–ï–ì–û–î–ù–Ø", tomorrow: "–ó–ê–í–¢–†–ê", d_after: "–ü–û–°–õ–ï–ó–ê–í–¢–†–ê", search: "–ü–æ–∏—Å–∫...", uv: "–£–§-–ò–ù–î–ï–ö–°", aqi: "–ö–ê–ß–ï–°–¢–í–û –í–û–ó–î–£–•–ê", uv_low: "–ù–∏–∑–∫–∏–π", uv_high: "–ó–∞—â–∏—Ç–∞", aqi_good: "–ß–∏—Å—Ç–æ", aqi_bad: "–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ",
            not_found: "üìç –ú–µ—Å—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", select_city: "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ:",
            hot: "üî• –ñ–∞—Ä–∞: –õ—ë–≥–∫–∞—è –æ–¥–µ–∂–¥–∞. –ù–∞–Ω–µ—Å–∏—Ç–µ SPF 50+ –∏ –ø–µ–π—Ç–µ –±–æ–ª—å—à–µ –≤–æ–¥—ã.",
            warm: "‚òÄÔ∏è –¢–µ–ø–ª–æ: –•–ª–æ–ø–∫–æ–≤—ã–µ —Ñ—É—Ç–±–æ–ª–∫–∏. –í–æ–∑—å–º–∏—Ç–µ –Ω–∞–∫–∏–¥–∫—É –¥–ª—è –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–æ–≤.",
            comfortable: "üçÉ –ü—Ä–∏—è—Ç–Ω–æ: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–æ–Ω–≥—Å–ª–∏–≤–∞ –∏–ª–∏ –ª—ë–≥–∫–æ–≥–æ —Å–≤–∏—Ç—à–æ—Ç–∞. –ö—É—Ä—Ç–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞.",
            chilly: "üå§Ô∏è –ü—Ä–æ—Ö–ª–∞–¥–Ω–æ: –û–¥–µ–Ω—å—Ç–µ—Å—å —Å–ª–æ—è–º–∏ ‚Äî –≤–µ—Ç—Ä–æ–≤–∫–∞ –∏–ª–∏ —Å–≤–∏—Ç–µ—Ä. –í–µ—á–µ—Ä–æ–º —Ö–æ–ª–æ–¥–∞–µ—Ç.",
            cold: "üß• –•–æ–ª–æ–¥–Ω–æ: –®–µ—Ä—Å—Ç—è–Ω–æ–µ –ø–∞–ª—å—Ç–æ –∏–ª–∏ —Ç—ë–ø–ª–∞—è –∫—É—Ä—Ç–∫–∞. –ù–∞–¥–µ–Ω—å—Ç–µ —à–∞—Ä—Ñ.",
            freezing: "‚ùÑÔ∏è –ú–æ—Ä–æ–∑: –¢—ë–ø–ª—ã–π –ø—É—Ö–æ–≤–∏–∫ –∏ —Ç–µ—Ä–º–æ–±–µ–ª—å—ë –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã. –ù–∞–¥–µ–Ω—å—Ç–µ –ø–µ—Ä—á–∞—Ç–∫–∏.",
            rain: " ‚òî –í–æ–∑—å–º–∏—Ç–µ –∑–æ–Ω—Ç –∏ –Ω–µ–ø—Ä–æ–º–æ–∫–∞–µ–º—É—é –æ–±—É–≤—å."
        },
        ar: {
            today: "ÿßŸÑŸäŸàŸÖ", tomorrow: "ÿ∫ÿØÿßŸã", d_after: "ÿ®ÿπÿØ ÿ∫ÿØ", search: "ÿ®ÿ≠ÿ´...", uv: "ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ£ÿ¥ÿπÿ©", aqi: "ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°", uv_low: "ŸÖŸÜÿÆŸÅÿ∂", uv_high: "ŸàÿßŸÇŸä ÿ¥ŸÖÿ≥", aqi_good: "ŸáŸàÿßÿ° ŸÜŸÇŸä", aqi_bad: "ÿ™ŸÑŸàÿ´",
            not_found: "üìç ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ", select_city: "ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàŸÇÿπ ÿ®ÿØŸÇÿ©:",
            hot: "üî• ÿ≠ÿ±ÿßÿ±ÿ© ÿ¥ÿØŸäÿØÿ©: ŸÖŸÑÿßÿ®ÿ≥ ÿÆŸÅŸäŸÅÿ© ÿ¨ÿØÿßŸã. ÿ∂ÿπ ŸàÿßŸÇŸä ÿ¥ŸÖÿ≥ Ÿàÿßÿ¥ÿ±ÿ® ÿßŸÑŸÉÿ´Ÿäÿ± ŸÖŸÜ ÿßŸÑŸÖÿßÿ°.",
            warm: "‚òÄÔ∏è ÿØÿßŸÅÿ¶: ŸÇŸÖÿµÿßŸÜ ŸÇÿ∑ŸÜŸäÿ© ÿÆŸÅŸäŸÅÿ©. ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ŸÇÿ∑ÿπÿ© ŸÑŸÑŸÖŸÉÿßŸÜ ÿßŸÑŸÖŸÉŸäŸÅ.",
            comfortable: "üçÉ ŸÑÿ∑ŸäŸÅ: ŸäŸÉŸÅŸä ŸÇŸÖŸäÿµ ÿ®ÿ£ŸÉŸÖÿßŸÖ ÿ∑ŸàŸäŸÑÿ© ÿ£Ÿà ÿ≥ÿ™ÿ±ÿ© ÿÆŸÅŸäŸÅÿ©. ÿßŸÑÿ¨Ÿà ŸÖÿ±Ÿäÿ≠ ÿ¨ÿØÿßŸã.",
            chilly: "üå§Ô∏è ÿ®ÿßÿ±ÿØ ŸÇŸÑŸäŸÑÿßŸã: ÿßÿ±ÿ™ÿØŸê ÿ≥ÿ™ÿ±ÿ© ÿÆŸÅŸäŸÅÿ© ŸÅŸàŸÇ ŸÖŸÑÿßÿ®ÿ≥ŸÉ. ÿßŸÜÿ™ÿ®Ÿá ŸÑÿ®ÿ±ŸàÿØÿ© ÿßŸÑŸÖÿ≥ÿßÿ°.",
            cold: "üß• ÿ®ÿßÿ±ÿØ: ŸÖÿπÿ∑ŸÅ ÿµŸàŸÅ ÿ£Ÿà ÿ≥ÿ™ÿ±ÿ© ÿ≥ŸÖŸäŸÉÿ©. ÿßÿ±ÿ™ÿØŸê Ÿàÿ¥ÿßÿ≠ÿßŸã ŸÑÿ≠ŸÖÿßŸäÿ© ÿßŸÑÿ±ŸÇÿ®ÿ©.",
            freezing: "‚ùÑÔ∏è ÿ¥ÿØŸäÿØ ÿßŸÑÿ®ÿ±ŸàÿØÿ©: ŸÖÿπÿ∑ŸÅ ÿ´ŸÇŸäŸÑ ŸàŸÖŸÑÿßÿ®ÿ≥ ÿ≠ÿ±ÿßÿ±Ÿäÿ© ÿ∂ÿ±Ÿàÿ±Ÿäÿ©. ÿßÿ±ÿ™ÿØŸê ŸÇŸÅÿßÿ≤ÿßÿ™.",
            rain: " ‚òî ÿ£ÿ≠ÿ∂ÿ± ŸÖÿ∏ŸÑÿ© Ÿàÿßÿ±ÿ™ÿØŸê ÿ£ÿ≠ÿ∞Ÿäÿ© ŸÖŸÇÿßŸàŸÖÿ© ŸÑŸÑŸÖÿßÿ° ŸÑŸÑÿ®ŸÇÿßÿ° ÿ¨ÿßŸÅÿßŸã."
        }
    };

    window.onload = () => {
        updatePlaceholder();
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => fetchAllWeather(p.coords.latitude, p.coords.longitude), () => searchCity('London'));
        } else { searchCity('London'); }
    };

    document.getElementById('cityInput').addEventListener('keypress', (e) => { 
        if (e.key === 'Enter') {
            document.getElementById('mainContainer').classList.add('loading');
            document.getElementById('citySelector').style.display = 'none';
            searchCity(e.target.value); 
        }
    });

    async function searchCity(city) {
        if (!city) return;
        try {
            const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=5&appid=${API_KEY}`);
            const geo = await res.json();
            if (!geo || geo.length === 0) {
                document.getElementById('location').innerText = i18n[currentLang].not_found;
                document.getElementById('mainContainer').classList.remove('loading');
                return;
            }
            if (geo.length === 1) { fetchAllWeather(geo[0].lat, geo[0].lon); } 
            else { showCityOptions(geo); }
        } catch (e) { document.getElementById('mainContainer').classList.remove('loading'); }
    }

    function showCityOptions(cities) {
        const selector = document.getElementById('citySelector');
        selector.innerHTML = `<div style="padding:10px; font-weight:bold; font-size:0.75rem; color:#aaa; border-bottom:1px solid #444;">${i18n[currentLang].select_city}</div>`;
        cities.forEach(c => {
            const div = document.createElement('div');
            div.className = 'city-option';
            div.innerText = `${c.name}${c.state ? ', ' + c.state : ''} (${c.country})`;
            div.onclick = () => {
                selector.style.display = 'none';
                document.getElementById('mainContainer').classList.add('loading');
                fetchAllWeather(c.lat, c.lon);
            };
            selector.appendChild(div);
        });
        selector.style.display = 'block';
        document.getElementById('mainContainer').classList.remove('loading');
    }

    async function fetchAllWeather(lat, lon) {
        try {
            const fRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${currentLang}`);
            weatherData = await fRes.json();
            const aRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
            const aqiData = await aRes.json();
            currentAQI = aqiData.list[0].main.aqi;
            updateDisplay();
            setTimeout(() => document.getElementById('mainContainer').classList.remove('loading'), 300);
        } catch (e) { document.getElementById('mainContainer').classList.remove('loading'); }
    }

    function updateDisplay() {
        if (!weatherData) return;
        document.getElementById('location').innerText = weatherData.city.name.toUpperCase();
        document.getElementById('current-day-label').innerText = [i18n[currentLang].today, i18n[currentLang].tomorrow, i18n[currentLang].d_after][dayOffset];
        const scroll = document.getElementById('hourlyAxis');
        scroll.innerHTML = '';
        const targetDate = new Date();
        targetDate.setDate(targetDate.getDate() + dayOffset);
        const dateStr = targetDate.toISOString().split('T')[0];
        
        let displayList = weatherData.list.filter(item => item.dt_txt.includes(dateStr));
        if (displayList.length < 5) {
            const startIndex = weatherData.list.findIndex(item => item.dt_txt.includes(dateStr));
            displayList = weatherData.list.slice(startIndex >= 0 ? startIndex : 0, (startIndex >= 0 ? startIndex : 0) + 8);
        }
        const focusData = displayList[0];
        
        setBackground(focusData.weather[0].main, focusData.weather[0].id, focusData.wind.speed, focusData.weather[0].icon);

        const temp = Math.round(focusData.main.temp);
        const uvValue = Math.max(1, Math.min(11, Math.floor(temp / 4) + (focusData.weather[0].main === 'Clear' ? 2 : 0)));
        
        document.getElementById('temp-val').innerText = temp;
        document.getElementById('weather-desc').innerText = focusData.weather[0].description;
        document.getElementById('uv-val').innerText = uvValue;
        document.getElementById('aqi-val').innerText = currentAQI;
        document.getElementById('label-uv').innerText = i18n[currentLang].uv;
        document.getElementById('label-aqi').innerText = i18n[currentLang].aqi;
        document.getElementById('uv-info').innerText = uvValue > 5 ? i18n[currentLang].uv_high : i18n[currentLang].uv_low;
        document.getElementById('aqi-info').innerText = currentAQI > 2 ? i18n[currentLang].aqi_bad : i18n[currentLang].aqi_good;

        const aqiBar = document.getElementById('aqi-bar-fill');
        const aqiColors = ["#4ade80", "#a3e635", "#fde047", "#fb923c", "#ef4444"];
        aqiBar.style.width = (currentAQI * 20) + "%";
        aqiBar.style.backgroundColor = aqiColors[currentAQI - 1] || "#4ade80";

        const uvBar = document.getElementById('uv-bar-fill');
        let uvColor = "#4ade80";
        if (uvValue >= 11) uvColor = "#a855f7";
        else if (uvValue >= 8) uvColor = "#ef4444";
        else if (uvValue >= 6) uvColor = "#fb923c";
        else if (uvValue >= 3) uvColor = "#fde047";
        uvBar.style.width = Math.min(100, (uvValue / 11) * 100) + "%";
        uvBar.style.backgroundColor = uvColor;

        let key = temp >= 32 ? 'hot' : temp >= 27 ? 'warm' : temp >= 20 ? 'comfortable' : temp >= 12 ? 'chilly' : temp >= 0 ? 'cold' : 'freezing';
        document.getElementById('advice').innerText = i18n[currentLang][key] + (focusData.weather[0].main.includes('Rain') ? i18n[currentLang].rain : "");

        displayList.forEach((item, idx) => {
            const time = item.dt_txt.split(' ')[1].substring(0, 5);
            scroll.innerHTML += `<div class="hour-item ${idx===0?'active':''}">
                <div class="hour-time">${time}</div>
                <img src="https://openweathermap.org/img/wn/${item.weather[0].icon}.png" width="35">
                <div class="hour-temp">${Math.round(item.main.temp)}¬∞</div>
            </div>`;
        });
    }

    function changeDay(step) {
        dayOffset = Math.max(0, Math.min(2, dayOffset + step));
        if(weatherData) updateDisplay();
    }

    function setBackground(main, id, windSpeed, icon) {
        const wrapper = document.getElementById('bg-wrapper');
        wrapper.innerHTML = '';
        const body = document.body;
        const isNight = icon.endsWith('n');
        const windOffset = Math.min(100, windSpeed * 8);
        document.documentElement.style.setProperty('--wind-offset', windOffset + 'px');

        if (main === 'Clear') {
            body.style.background = isNight ? "linear-gradient(to bottom, #141e30, #243b55)" : "linear-gradient(to bottom, #2193b0, #6dd5ed)";
            const glow = document.createElement('div'); glow.className = isNight ? 'moon-glow' : 'sun-glow'; wrapper.appendChild(glow);
        } else if (main === 'Snow') {
            body.style.background = isNight ? "#0f0c29" : "#485563"; 
            let count = id === 602 || id === 622 ? 200 : 80;
            for(let i=0; i<count; i++) {
                let s = document.createElement('div'); s.className = 'snow'; s.style.left = Math.random()*120-10+'vw';
                s.style.width = s.style.height = (Math.random()*5 + 2)+'px'; s.style.animationDuration = (4 + Math.random()*4)+'s';
                wrapper.appendChild(s);
            }
        } else if (main === 'Rain' || main === 'Drizzle') {
            body.style.background = isNight ? "linear-gradient(to bottom, #000428, #004e92)" : "linear-gradient(to bottom, #3a7bd5, #3a6073)";
            let count = (id >= 502 && id <= 504) ? 250 : 80;
            for(let i=0; i<count; i++) {
                let d = document.createElement('div'); d.className = 'rain'; d.style.left = Math.random()*120-10+'vw'; 
                d.style.width = (main === 'Drizzle' ? 1 : 2) + 'px'; d.style.animationDuration = (0.5 + Math.random()*(1 / (windSpeed*0.5 + 1)))+'s';
                wrapper.appendChild(d);
            }
        } else {
            body.style.background = isNight ? "#2c3e50" : "#607d8b";
            for(let i=0; i<3; i++) {
                let c = document.createElement('div'); c.className = 'cloud'; c.style.top = (15+i*25)+'vh'; 
                c.style.width = (300 + Math.random()*200)+'px'; c.style.height = '200px';
                c.style.animationDuration = Math.max(5, 40 - windSpeed*3) + 's'; wrapper.appendChild(c);
            }
        }
    }

    function changeLanguage() {
        currentLang = document.getElementById('langSelect').value;
        document.body.className = (currentLang === 'ar') ? 'rtl' : '';
        updatePlaceholder();
        if (weatherData) fetchAllWeather(weatherData.city.coord.lat, weatherData.city.coord.lon);
    }
    function updatePlaceholder() { document.getElementById('cityInput').placeholder = i18n[currentLang].search; }
</script>
</body>
</html>
